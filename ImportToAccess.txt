Documentation adapted from Arnold Amman's Instructions for VUE 1.8/CSV 1.0

SECTION 1 - VUE 2+ (2.1.3 & 2.2.0 tested):

Using VUE to process and correct clock drift for VR2W/VR3 files:
In Windows Explorer a.k.a. My Computer
1. Find the VRLs that you wish to process and place them all into the same directory on your computer.
   This directory should not have any VRLs that you don't intend to process.
2. Create a subdirectory (within the above directory) that will house the drift-corrected data (e.g. "drift" or "DC").
3. In the drift subdirectory, go to the address bar of your windows explorer window* and copy your directory path (Ctrl+C).

* You can navigate to your Windows Explorer address bar by pressing Alt+D on your keyboard
  In Windows 8 or later, you can alternatively use Ctrl+L (which is incidentally what Macs and Linux support).

In VUE
4. Run VUE and then Create a new VUE DB for drift-corrected data.
   Click on FILE -> New Database...
   Press "Ctrl-V" to indicate the created subdirectory.
   Type a "\" followed by a database name, e.g. "\drift-corrected"
   Press <Enter> or click "Open".
5. Change the output location for the individual drift-corrected VRLs.
   Click on FILE -> "Options" button (not in the drop-down menu) -> "Offload" tab -> "Change" button.
   Press "Ctrl-V" <Enter> to select the subdirectory if possible.
      Note: you may have to manually navigate here, pending a VEMCO update to VUE.)
   While you're in the VUE Options, adjust the CSV export options as desired
      Click the "Export" tab within the options. Please either
         Select "Default format" .
            - OR - 
         Select "Custom"
         Select "Default" column names in the dropdown menu within the Custom Configuration section
         Check the checkboxes next to "no trailing commas" and "Millisecond time precision
            - OR -
         (NOT recommended) Select "Version 1.0 format"
   Click "OK".
6. Import the non-drift-corrected VRLs and drift correct.
   Click on FILE -> Tools -> VRL File Editor
   Click on the address bar (or Alt-D/Ctrl-L)
   "Ctrl-V" to paste the previously copied directory
   then press the "Backspace" key on your keyboard to navigate "up" one level to the non-drift-corrected data.
   Click the top(-left) VRL file, then hold down your shift key, click on the bottom(-right) VRL file - this selects all the VRLs in the directory.
   Hit <Enter> or click "OK".
   The "Edit and Import VRL Files" dialogue should pop up. In this every second line is the file that you're importing.
      On these lines, ensure Time Zone is set to UTC (otherwise click on the value there and select "0" then click outside of the box).
   Click "Autocorrect".
   Click "Import" (your response for the radio button dialogue doesn't matter, as the database is empty).
   Click "OK" when appropriate.
7. Check and Export your Detections.
   Click on the DETECTIONS tab.
   Delete your tester tags from the Transmitters section in the left pane (right click, select delete or just press the "delete" key on your keyboard).
   Click back to "All Detections" or create an appropriate filtered subset in the left pane.
   Click the export (red arrow pointing right) button -> Export CSV.
   Change "Sensor format" to "Raw sensor values".
   "Change" the Output File at the top. "Ctrl-V" .
   "\" followed by an output file name, e.g. filtered-drift-corrected or all-DCd. Make sure there are no spaces in the file name.
   Click "Save" or Press <Enter>.
   
--------------------------------------------------------------------

SECTION 2 - PERL/MS-DOS:

0. DOS background
   If the instructions to follow call for you to get to a DOS Command Prompt or "cmd.exe"
      Windows XP/Vista: Start->Run Type "cmd.exe"<enter>.
      Windows 7/8/8.1/10: Press the Windows Key, type "cmd", click on the entry.
   To move your cursor within the Command Prompt window, the mouse won't work as you intend.
      Instead, use the left and right arrow keys on the keyboard.
   To paste from the clipboard into the Command Prompt window, you cannot use Ctrl-V
      Instead right click your mouse and select "Paste"
   To copy to the clipboard from the Command Prompt, you cannot use Ctrl-C or Ctrl-X. Instead
      Right click and select "Mark"
      Highlight the text
         Note: if you wish to copy multiple lines, this selection marks a rectangle on the screen, so start all the way to the left side of the top line that you want and drag through the very end of the second line.
      Hit "Enter" to copy the highlighted text to the clipboard

1. Perl installation check: prior to first use only

   A) Choose a Perl installation online (e.g. Strawberry Perl, ActiveState Perl, both available as external links from http://www.perl.org/get.html), download and install it according to the relevant instructions.

   B) Check and/or set your Windows PATH and PERL5LIB environment variables to look for Perl directories.
      If you wish to add capability to run VUE-to-CFTC for a single login account on your computer (or do not have administrator-level access on your computer)
         From cmd.exe type '"C:\Windows\system32\rundll32.exe" sysdm.cpl,EditEnvironmentVariables' (include "s, but not 's).
         In the top group (User variables for <username>), Edit "Path" or click "New..." if "Path" not present.
            Variable name will be "PATH", Variable value e.g. "C:\strawberry\perl\bin" (WARNING see *).
      If you wish to add capability to run VUE-to-CFTC for all users on your computer and have the appropriate administrator access
         From cmd.exe type
            Windows 7-10: "control sysdm.cpl,,3"<enter>.
            - OR -
            Any Windows: "rundll32.exe shell32.dll,Control_RunDLL sysdm.cpl,,3"<enter>.
         Type a username/password for a user with ADMINISTRATOR level access if prompted.
         Click "Environment Variables".
         In the System variables (bottom) section, Edit "Path" or click "New..." if "Path" not present.
            Variable name will be "PATH", Variable value e.g. "C:\strawberry\perl\bin" (WARNING see *).
      Create a new variable named PERL5LIB with value e.g. "C:\strawberry\perl\lib" using the same method as described for PATH
      Click "OK" to save the changes to the relevant environment variables

* If there are other values present for this environment variable, please separate existing entries from this entry with a ";".
  WARNING Erasing existing values may lead to significant issues with other programs installed on your computer!
     e.g. "C:\strawberry\perl\bin;C:\windows;C:\windows\system32" if the old value was "C:\windows;C:\windows\system32"

   C) This script requires Perl modules Date::Calc, Data::Types and Carp installed on the machine to work as intended.
      To install these and other Perl modules (once Perl itself is installed):
         Run CPAN (requires an active internet connection) by either
            going to your relevant start menu item e.g. \Strawberry Perl (64-bit)\Tools\CPAN Client from your Start Menu->Programs.
            - OR - 
            on "cmd.exe" type "perl -MCPAN -e shell"<Enter>.
         Within CPAN type "install Date::Calc Data::Types Carp"<Enter>.
            Feel free to tag other modules such as cpanm on to the end of the preceding.
         Type "exit"<enter>; if the window doesn't close, type "exit"<enter> again.

2. Use Perl script
   Note: after your first use of the program, this is the only DOS or Perl step needed and further does not require you to know Perl or Windows Command Prompt syntax.
      In windows, please select and then drag the desired .csv file(s en masse) generated by VUE on top of one of the three vue-to-cftc.bats.
         vue-to-cftc-plusMS.bat - will include milliseconds in output for all detections, including those with no specified milliseconds value (0ms).
         vue-to-cftc-noMS.bat - will never include milliseconds, even if present in VUE output. This version is the most compatible with earlier versions of Microsoft Access.
         vue-to-cftc.bat - will include milliseconds on entries that have milliseconds available from the VUE export. On entries without specified milliseconds (or with exactly 0ms) the output will not include milliseconds. This version is untested with regard to Microsoft Access, but should be roughly as compatible as the plusMS version.
      This will process all CSV files at once, so feel free to select multiple files prior to dropping on the .bat.
         The .bat files must be in the same directory as the .pl file.
         This script generates a file in the format of "ConvertVUE2forCFTC-output-yyyymmdd_hhmmss.csv" in that directory.
            The time stamp refers to the time the script was run, not the timestamp of the input file(s).

--------------------------------------------------------------------

SECTION 3 - MSAccess*

*instructions written for MSAccess 2010 - slight modification may be needed for other versions. If unable to perform steps 3-4 due to incompatibility, please send the file generated after step 2; you may alternatively use or adapt the Orphans queries to perform manual quality-control.

1. Import the generated CSV into the MSAccess DB attached (note: please leave this file as a .mdb. Do not save in the more recent .accdb format).
   Go to "External Data"->"(import & link section) Text File...".
   Input the file path as the data source.
      Helpful Windows tip: hold shift and right click on the file in Explorer and select "copy as path" then paste it into Access's file name field.
   Click "append a copy of the records to the table: Import_Detections" and click "Next" a few times.

2. Import/Enter data into the Import_Deployments table as appropriate to cover all times that you had a deployment.

3. Double-click "mEstablishTableMenu" in the Macros section for the first use on your computer.  Then hit escape or click anywhere.

4. Double-click "mMoveOrphans" in the Macros section.  Follow the prompts.
   If it says you have a lot of Orphans, you'll probably want to either look at your Deployment windows or your Detections in detail.
   The final step of this macro allows you to choose to Delete the Orphaned detections from the original table.
      If you cancel the last step, the net effect will be to COPY, rather than MOVE, the affected detections to the DetectOrphans table.

--------------------------------------------------------------------

SECTION 4 - Communication with CFTC

Send the MSAccess .mdb file processed in SECTION 3 to Matt Pagel via e-mail, Box or Google Drive for upload to the main database. You may also send VRL files for archival purposes. In the future, we intend to have this capability built into a webpage.

Use a new copy of the MSAccess .mdb file each time. Alternatively, you can clear/delete the tables, which can be regenerated by clicking the relevant qCreate query. Periodically select "Compact and Repair" from the File menu of MSAccess to reduce the size of the database if you follow this alternate method.
